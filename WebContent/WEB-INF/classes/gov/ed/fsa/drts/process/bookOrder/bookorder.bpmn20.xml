<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" 
		targetNamespace="http://www.bpmnwithactiviti.org"
    xmlns:activiti="http://activiti.org/bpmn">
		
	<process id="bookorder" name="bookorder">
		<startEvent id="startEvent" name="Start" activiti:formKey="/bookOrder/newOrder.htm" />
    <sequenceFlow id="toCompletedOrderTask" sourceRef="startEvent" targetRef="completeOrderTask"/>
		<userTask id="completeOrderTask" name="Complete order" activiti:formKey="/bookOrder/completeOrder.htm">
		
		<potentialOwner>
	        	<resourceAssignmentExpression>
	          		<formalExpression>management</formalExpression>
	        	</resourceAssignmentExpression>
	      	</potentialOwner> 
    </userTask>
    <sequenceFlow id="toEmailEvent" sourceRef="completeOrderTask" targetRef="sendMail"/>
    
    <serviceTask id="sendMail" activiti:type="mail">
  <extensionElements>
    <activiti:field name="to" expression="${recipient_email}" />
    <activiti:field name="subject" expression="Your order ${isbn} has been processed" />
    <activiti:field name="html">
      <activiti:expression>
        <![CDATA[
          <html>
            <body>
              Hello ${book_requestor},<br/><br/>
                 
              Approved? = ${approved_denied} <br/><br/>
                 
              Attachments = ${order_attachments} <br/><br/>
                  
              Kind regards,<br/>
                  
              ${decision_by}
            </body>
          </html>
        ]]>
      </activiti:expression>
    </activiti:field>      
  </extensionElements>
</serviceTask> 


    <sequenceFlow id="toEndEvent" sourceRef="sendMail" targetRef="endEvent"/>
    
		<endEvent id="endEvent" name="End"/>
	</process>
</definitions>